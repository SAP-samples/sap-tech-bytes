{"version":3,"file":"ErrorHandler.js","names":["ErrorHandler","UI5Object","extend","constructor","_constructor","component","UI5Object.prototype.constructor.call","resourceBundle","getModel","getResourceBundle","model","messageOpen","errorText","getText","attachMetadataFailed","event","responseText","getParameter","showServiceError","attachRequestFailed","response","statusCode","indexOf","_showServiceError","details","JSON","parse","ex","MessageBox","error","id","styleClass","getContentDensityClass","onClose"],"sources":["../../src/controller/ErrorHandler.ts"],"sourcesContent":["import UI5Object from \"sap/ui/base/Object\";\nimport MessageBox from \"sap/m/MessageBox\";\nimport { Action } from \"sap/m/MessageBox\";\n\nimport ResourceBundle from \"sap/base/i18n/ResourceBundle\";\nimport UIComponent from \"sap/ui/core/UIComponent\";\nimport AppComponent from \"../Component\";\nimport ResourceModel from \"sap/ui/model/resource/ResourceModel\";\nimport UI5Event from \"sap/ui/base/Event\";\nimport ODataModel from \"sap/ui/model/odata/v2/ODataModel\";\n\ntype ui5Response = {\n\t/**\n\t * A text that describes the failure.\n\t */\n\tmessage?: string;\n\t/**\n\t * HTTP status code returned by the request (if available)\n\t */\n\tstatusCode?: string;\n\t/**\n\t * The status as a text, details not specified, intended only for diagnosis output\n\t */\n\tstatusText?: string;\n\t/**\n\t * Response that has been received for the request ,as a text string\n\t */\n\tresponseText?: string;\n};\n\n/**\n * @namespace sap.ui.demo.controller\n */\nexport default class ErrorHandler extends UI5Object {\n\tprivate resourceBundle: ResourceBundle;\n\tprivate component: AppComponent;\n\tprivate model: ODataModel;\n\tprivate messageOpen: boolean;\n\tprivate errorText: string;\n\n\tconstructor(component: UIComponent) {\n\t\tsuper();\n\n\t\tthis.resourceBundle = ((component.getModel(\"i18n\") as ResourceModel).getResourceBundle() as ResourceBundle);\n\t\tthis.component = (component as AppComponent);\n\t\tthis.model = (component.getModel() as ODataModel);\n\t\tthis.messageOpen = false;\n\t\tthis.errorText = this.resourceBundle.getText(\"errorText\");\n\n\t\tthis.model.attachMetadataFailed((event: UI5Event) => {\n\t\t\tconst responseText = (event.getParameter(\"response\") as ui5Response);\n\t\t\tthis.showServiceError(responseText);\n\t\t});\n\t\tthis.model.attachRequestFailed((event: UI5Event) => {\n\t\t\tconst response = (event.getParameter(\"response\") as ui5Response);\n\t\t\t// An entity that was not found in the service is also throwing a 404 error in oData.\n\t\t\t// We already cover this case with a notFound target so we skip it here.\n\t\t\t// A request that cannot be sent to the server is a technical error that we have to handle though\n\t\t\tif (response.statusCode !== \"404\" || (response.statusCode == \"404\" && response.responseText.indexOf(\"Cannot POST\") === 0)) {\n\t\t\t\tthis.showServiceError(response);\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Shows a {@link sap.m.MessageBox} when a service call has failed.\n\t * Only the first error message will be display.\n\t * @param {string} sDetails a technical error to be displayed on request\n\t * @private\n\t */\n\tprivate showServiceError(details: ui5Response) {\n\t\tif (this.messageOpen) {\n\t\t\treturn;\n\t\t}\n\t\tthis.messageOpen = true;\n\t\tlet responseText:any;\n\n\t\tif(details.responseText){\n\t\t\ttry{\n\t\t\t\tresponseText = (JSON.parse(details.responseText) as unknown);\n\t\t\t}catch(ex){\n\t\t\t\tresponseText = details.responseText;\n\t\t\t}\n\t\t}\n\t\tMessageBox.error(\n\t\t\tthis.errorText,\n\t\t\t{\n\t\t\t\tid: \"serviceErrorMessageBox\",\n\t\t\t\tdetails: (responseText as unknown as string),\n\t\t\t\tstyleClass: this.component.getContentDensityClass(),\n\t\t\t\t// actions : [Action.CLOSE],\n\t\t\t\tonClose: () => {\n\t\t\t\t\tthis.messageOpen = false;\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n}"],"mappings":";EA8BA;AACA;AACA;EAFA,MAGqBA,YAAY,GAASC,SAAS,CAAAC,MAAA;IAOlDC,WAAW,WAAAC,aAACC,SAAsB,EAAE;MACnCC,oCAAA;MAEA,IAAI,CAACC,cAAc,GAAKF,SAAS,CAACG,QAAQ,CAAC,MAAM,CAAC,CAAmBC,iBAAiB,CAAC,CAAoB;MAC3G,IAAI,CAACJ,SAAS,GAAIA,SAA0B;MAC5C,IAAI,CAACK,KAAK,GAAIL,SAAS,CAACG,QAAQ,CAAC,CAAgB;MACjD,IAAI,CAACG,WAAW,GAAG,KAAK;MACxB,IAAI,CAACC,SAAS,GAAG,IAAI,CAACL,cAAc,CAACM,OAAO,CAAC,WAAW,CAAC;MAEzD,IAAI,CAACH,KAAK,CAACI,oBAAoB,CAAEC,KAAe,IAAK;QACpD,MAAMC,YAAY,GAAID,KAAK,CAACE,YAAY,CAAC,UAAU,CAAiB;QACpE,IAAI,CAACC,gBAAgB,CAACF,YAAY,CAAC;MACpC,CAAC,CAAC;MACF,IAAI,CAACN,KAAK,CAACS,mBAAmB,CAAEJ,KAAe,IAAK;QACnD,MAAMK,QAAQ,GAAIL,KAAK,CAACE,YAAY,CAAC,UAAU,CAAiB;QAChE;QACA;QACA;QACA,IAAIG,QAAQ,CAACC,UAAU,KAAK,KAAK,IAAKD,QAAQ,CAACC,UAAU,IAAI,KAAK,IAAID,QAAQ,CAACJ,YAAY,CAACM,OAAO,CAAC,aAAa,CAAC,KAAK,CAAE,EAAE;UAC1H,IAAI,CAACJ,gBAAgB,CAACE,QAAQ,CAAC;QAChC;MACD,CAAC,CAAC;IACH,CAAC;IAQOF,gBAAgB,WAAAK,kBAACC,OAAoB,EAAE;MAC9C,IAAI,IAAI,CAACb,WAAW,EAAE;QACrB;MACD;MACA,IAAI,CAACA,WAAW,GAAG,IAAI;MACvB,IAAIK,YAAgB;MAEpB,IAAGQ,OAAO,CAACR,YAAY,EAAC;QACvB,IAAG;UACFA,YAAY,GAAIS,IAAI,CAACC,KAAK,CAACF,OAAO,CAACR,YAAY,CAAa;QAC7D,CAAC,QAAMW,EAAE,EAAC;UACTX,YAAY,GAAGQ,OAAO,CAACR,YAAY;QACpC;MACD;MACAY,UAAU,CAACC,KAAK,CACf,IAAI,CAACjB,SAAS,EACd;QACCkB,EAAE,EAAE,wBAAwB;QAC5BN,OAAO,EAAGR,YAAkC;QAC5Ce,UAAU,EAAE,IAAI,CAAC1B,SAAS,CAAC2B,sBAAsB,CAAC,CAAC;QACnD;QACAC,OAAO,EAAEA,CAAA,KAAM;UACd,IAAI,CAACtB,WAAW,GAAG,KAAK;QACzB;MACD,CACD,CAAC;IACF;EAAC;EAAA,OA/DmBX,YAAY;AAAA"}